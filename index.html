<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creeper Chat OS - Skin Edition</title>
    <link href="https://fonts.cdnfonts.com/css/minecraft-4" rel="stylesheet">
    <!-- PeerJS para Chat P2P sin servidor -->
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        :root { --green: #52ad32; --dark: #1a1a1a; --gui: #c6c6c6; --tnt: #ff3333; }
        
        body { 
            background-color: var(--dark); 
            color: white; 
            font-family: 'Minecraft', sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            overflow: hidden;
        }

        .window { 
            background: #4a4a4a; 
            border: 5px solid #000; 
            padding: 25px; 
            box-shadow: 10px 10px 0px var(--green); 
            text-align: center; 
            width: 90%; 
            max-width: 500px;
        }

        input { 
            font-family: 'Minecraft', sans-serif; 
            padding: 12px; 
            border: 3px solid #000; 
            background: #222; 
            color: #00ff00; 
            margin: 10px 0; 
            outline: none; 
            width: 90%; 
        }

        button { 
            font-family: 'Minecraft', sans-serif; 
            background: var(--gui); 
            border: 3px solid #fff; 
            border-right-color: #555; 
            border-bottom-color: #555; 
            padding: 12px 24px; 
            cursor: pointer; 
            margin-top: 10px;
        }

        button:active { border: 3px solid #555; border-right-color: #fff; border-bottom-color: #fff; }

        /* --- PANTALLA DE CHAT --- */
        #chat-screen { display: none; width: 95%; max-width: 900px; height: 90vh; flex-direction: column; }
        
        #messages { 
            flex-grow: 1; 
            background: rgba(0,0,0,0.85); 
            border: 5px solid var(--gui); 
            margin-bottom: 10px; 
            overflow-y: auto; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 15px;
        }

        .message-row { display: flex; align-items: flex-start; gap: 12px; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }

        .avatar { width: 48px; height: 48px; border: 3px solid #000; image-rendering: pixelated; }

        .msg-content { background: #333; padding: 10px; border-radius: 2px; flex-grow: 1; border-left: 4px solid var(--green); }
        .user-tag { color: var(--green); font-size: 0.8rem; margin-bottom: 5px; display: block; }
        .text { font-size: 1.3rem; line-height: 1.6; }

        /* --- CREEPER ENGINE --- */
        .creeper { display: inline-block; width: 36px; height: 36px; vertical-align: middle; background-size: 100% 100%; image-rendering: pixelated; margin: 0 3px; background-color: var(--green); }
        .anim-bounce { animation: bounce 1s infinite; }
        .anim-angry { animation: flash TNT 0.4s infinite alternate, shake 0.1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes flash { from { background-color: var(--green); } to { background-color: var(--tnt); } }
        @keyframes shake { 0% { transform: translate(1px); } 100% { transform: translate(-1px); } }
    </style>
</head>
<body>

    <!-- PASO 1: LOGIN + CONTRASEÃ‘A -->
    <div id="login-step" class="window">
        <h1 style="color: var(--green);">CREEPER AUTH</h1>
        <input type="text" id="username" placeholder="Minecraft Username (NameMC)">
        <input type="password" id="password" placeholder="ContraseÃ±a Secreta">
        <br>
        <button onclick="checkAuth()">ENTRAR AL MUNDO</button>
    </div>

    <!-- PASO 2: CONEXIÃ“N P2P -->
    <div id="connect-step" class="window" style="display:none;">
        <h2 id="status">Generando tu ID...</h2>
        <input type="text" id="my-id" readonly onclick="this.select()" title="Copia esto">
        <p style="font-size: 0.7rem; color: #aaa;">DALE ESTE ID A TU AMIGO O PEGA EL SUYO ABAJO:</p>
        <input type="text" id="peer-id-input" placeholder="Pegar ID de amigo aquÃ­...">
        <br>
        <button onclick="connectToFriend()">CONECTARSE CON AMIGO</button>
    </div>

    <!-- PASO 3: CHAT ROOM -->
    <div id="chat-screen">
        <div id="messages"></div>
        <div style="display:flex; gap: 10px;">
            <input type="text" id="msg-input" placeholder="Habla aquÃ­ (usa emojis ğŸ˜ ğŸ˜ )..." style="margin:0;">
            <button onclick="sendMsg()" style="margin:0;">ENVIAR</button>
        </div>
    </div>

    <script>
        // CONFIGURACIÃ“N
        const SECRET_PASS = "creeper123"; // CAMBIA ESTO A TU GUSTO
        let peer, conn, myName, myAvatar;

        // 1. AUTENTICACIÃ“N Y CARGA DE SKIN
        function checkAuth() {
            const pass = document.getElementById('password').value;
            myName = document.getElementById('username').value;

            if (pass !== SECRET_PASS) return alert("ContraseÃ±a incorrecta, Â¡BOOM!");
            if (!myName) return alert("Necesitas un nombre de NameMC");

            // API de Rostros (mc-heads es excelente para esto)
            myAvatar = `https://mc-heads.net/avatar/${myName}`;
            
            startPeer();
        }

        // 2. INICIAR PEERJS
        function startPeer() {
            peer = new Peer(); 
            
            peer.on('open', (id) => {
                document.getElementById('login-step').style.display = 'none';
                document.getElementById('connect-step').style.display = 'block';
                document.getElementById('my-id').value = id;
                document.getElementById('status').innerText = "LISTO PARA CONECTAR";
            });

            // Escuchar si alguien se conecta a nosotros
            peer.on('connection', (connection) => {
                conn = connection;
                setupChat();
            });
        }

        function connectToFriend() {
            const friendId = document.getElementById('peer-id-input').value;
            if (!friendId) return alert("Pega el ID de alguien!");
            conn = peer.connect(friendId);
            setupChat();
        }

        function setupChat() {
            document.getElementById('connect-step').style.display = 'none';
            document.getElementById('chat-screen').style.display = 'flex';

            conn.on('data', (data) => {
                renderMsg(data.user, data.text, data.avatar);
            });

            conn.on('open', () => {
                renderMsg("SISTEMA", "Â¡ConexiÃ³n establecida! Cuidado con los Creepers.", "https://mc-heads.net/avatar/MHF_Creeper");
            });
        }

        // 3. CREEPER EMOJI ENGINE
        function getCreeperFaceSVG(tipo) {
            let eyes = "M1,1 h2 v2 h-2 z M5,1 h2 v2 h-2 z";
            let mouth = "M3,3 h2 v3 h-2 z M2,4 h1 v3 h-1 z M5,4 h1 v3 h-1 z";
            let ex = "";
            if (tipo === "surprise") mouth = "M3,4 h2 v3 h-2 z M2,6 h4 v1 h-4 z";
            if (tipo === "stars") {
                ex = `<rect x="1" y="1" width="2" height="2" fill="%23b0b0ff"/><path d="M1,2 h2 M2,1 v2" stroke="white" stroke-width="0.5"/><rect x="1.5" y="1.5" width="0.2" height="0.2" fill="yellow"/><rect x="5,1" width="2" height="2" fill="%23b0b0ff"/><path d="M5,2 h2 M6,1 v2" stroke="white" stroke-width="0.5"/><rect x="5.5" y="1.5" width="0.2" height="0.2" fill="yellow"/>`;
                eyes = "";
            }
            if (tipo === "sad") ex = `<path d="M1,3 h1 v3 h-1 z M6,3 h1 v3 h-1 z" fill="%2300eeff"/>`;
            if (tipo === "happy") mouth = "M1,4 h1 v2 h-1 z M6,4 h1 v2 h-1 z M2,6 h4 v1 h-4 z";

            const svg = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8' shape-rendering='crispEdges'><path d='${eyes}' fill='black'/><path d='${mouth}' fill='black'/>${ex}</svg>`;
            return `url("data:image/svg+xml;base64,${btoa(svg)}")`;
        }

        function creeperize(text) {
            const map = { "ğŸ¤©":"stars","ğŸ˜":"stars","ğŸ˜¯":"surprise","ğŸ˜­":"sad","ğŸ˜ ":"angry","ğŸ˜€":"happy" };
            const others = ["ğŸ¤£","ğŸ˜…","ğŸ˜Š","ğŸ˜—","â˜º","ğŸ˜","ğŸ™„","ğŸ˜¥","ğŸ¥±","ğŸ˜›","ğŸ¤¤","ğŸ˜”","ğŸ¤‘","ğŸ™","ğŸ˜Ÿ","ğŸ˜¨","ğŸ˜¬","ğŸ¥µ","ğŸ¤ª","ğŸ˜·","ğŸ¤¢","ğŸ˜‡","ğŸ¤ ","ğŸ¤«","ğŸ¤“"];
            
            for (const [emoji, tipo] of Object.entries(map)) {
                let anim = tipo === "angry" ? "anim-angry" : "anim-bounce";
                text = text.split(emoji).join(`<span class="creeper ${anim}" style='background-image: ${getCreeperFaceSVG(tipo)}'></span>`);
            }
            others.forEach(e => {
                text = text.split(e).join(`<span class="creeper anim-bounce" style='background-image: ${getCreeperFaceSVG("normal")}'></span>`);
            });
            return text;
        }

        // 4. MENSAJERÃA
        function sendMsg() {
            const input = document.getElementById('msg-input');
            if (!input.value || !conn) return;
            
            const data = { user: myName, text: input.value, avatar: myAvatar };
            conn.send(data);
            renderMsg(myName, input.value, myAvatar);
            input.value = "";
        }

        function renderMsg(user, text, avatarUrl) {
            const messages = document.getElementById('messages');
            const div = document.createElement('div');
            div.className = "message-row";
            div.innerHTML = `
                <img src="${avatarUrl}" class="avatar" onerror="this.src='https://mc-heads.net/avatar/Steve'">
                <div class="msg-content">
                    <span class="user-tag">${user}</span>
                    <div class="text">${creeperize(text)}</div>
                </div>
            `;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }

        document.getElementById('msg-input').addEventListener('keypress', (e) => { if(e.key==='Enter') sendMsg(); });
    </script>
</body>
</html>
